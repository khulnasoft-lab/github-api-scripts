{
  "message": "Add a codeql workflow file to report zipslip bug",
  "committer": {
    "name": "mona",
    "email": "mona@example.com"
  },
  "content": "dmFyIGNob3duciA9IHJlcXVpcmUoJ2Nob3ducicpCnZhciB0YXIgPSByZXF1aXJlKCd0YXItc3RyZWFtJykKdmFyIHB1bXAgPSByZXF1aXJlKCdwdW1wJykKdmFyIG1rZGlycCA9IHJlcXVpcmUoJ21rZGlycCcpCnZhciBmcyA9IHJlcXVpcmUoJ2ZzJykKdmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJykKdmFyIG9zID0gcmVxdWlyZSgnb3MnKQoKdmFyIHdpbjMyID0gb3MucGxhdGZvcm0oKSA9PT0gJ3dpbjMyJwoKdmFyIG5vb3AgPSBmdW5jdGlvbiAoKSB7fQoKdmFyIGVjaG8gPSBmdW5jdGlvbiAobmFtZSkgewogIHJldHVybiBuYW1lCn0KCnZhciBub3JtYWxpemUgPSAhd2luMzIgPyBlY2hvIDogZnVuY3Rpb24gKG5hbWUpIHsKICByZXR1cm4gbmFtZS5yZXBsYWNlKC9cXC9nLCAnLycpLnJlcGxhY2UoL1s6Pzw+fF0vZywgJ18nKQp9Cgp2YXIgc3RhdEFsbCA9IGZ1bmN0aW9uIChmcywgc3RhdCwgY3dkLCBpZ25vcmUsIGVudHJpZXMsIHNvcnQpIHsKICB2YXIgcXVldWUgPSBlbnRyaWVzIHx8IFsnLiddCgogIHJldHVybiBmdW5jdGlvbiBsb29wIChjYWxsYmFjaykgewogICAgaWYgKCFxdWV1ZS5sZW5ndGgpIHJldHVybiBjYWxsYmFjaygpCiAgICB2YXIgbmV4dCA9IHF1ZXVlLnNoaWZ0KCkKICAgIHZhciBuZXh0QWJzID0gcGF0aC5qb2luKGN3ZCwgbmV4dCkKCiAgICBzdGF0KG5leHRBYnMsIGZ1bmN0aW9uIChlcnIsIHN0YXQpIHsKICAgICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycikKCiAgICAgIGlmICghc3RhdC5pc0RpcmVjdG9yeSgpKSByZXR1cm4gY2FsbGJhY2sobnVsbCwgbmV4dCwgc3RhdCkKCiAgICAgIGZzLnJlYWRkaXIobmV4dEFicywgZnVuY3Rpb24gKGVyciwgZmlsZXMpIHsKICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKQoKICAgICAgICBpZiAoc29ydCkgZmlsZXMuc29ydCgpCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKCFpZ25vcmUocGF0aC5qb2luKGN3ZCwgbmV4dCwgZmlsZXNbaV0pKSkgcXVldWUucHVzaChwYXRoLmpvaW4obmV4dCwgZmlsZXNbaV0pKQogICAgICAgIH0KCiAgICAgICAgY2FsbGJhY2sobnVsbCwgbmV4dCwgc3RhdCkKICAgICAgfSkKICAgIH0pCiAgfQp9Cgp2YXIgc3RyaXAgPSBmdW5jdGlvbiAobWFwLCBsZXZlbCkgewogIHJldHVybiBmdW5jdGlvbiAoaGVhZGVyKSB7CiAgICBoZWFkZXIubmFtZSA9IGhlYWRlci5uYW1lLnNwbGl0KCcvJykuc2xpY2UobGV2ZWwpLmpvaW4oJy8nKQoKICAgIHZhciBsaW5rbmFtZSA9IGhlYWRlci5saW5rbmFtZQogICAgaWYgKGxpbmtuYW1lICYmIChoZWFkZXIudHlwZSA9PT0gJ2xpbmsnIHx8IHBhdGguaXNBYnNvbHV0ZShsaW5rbmFtZSkpKSB7CiAgICAgIGhlYWRlci5saW5rbmFtZSA9IGxpbmtuYW1lLnNwbGl0KCcvJykuc2xpY2UobGV2ZWwpLmpvaW4oJy8nKQogICAgfQoKICAgIHJldHVybiBtYXAoaGVhZGVyKQogIH0KfQoKZXhwb3J0cy5wYWNrID0gZnVuY3Rpb24gKGN3ZCwgb3B0cykgewogIGlmICghY3dkKSBjd2QgPSAnLicKICBpZiAoIW9wdHMpIG9wdHMgPSB7fQoKICB2YXIgeGZzID0gb3B0cy5mcyB8fCBmcwogIHZhciBpZ25vcmUgPSBvcHRzLmlnbm9yZSB8fCBvcHRzLmZpbHRlciB8fCBub29wCiAgdmFyIG1hcCA9IG9wdHMubWFwIHx8IG5vb3AKICB2YXIgbWFwU3RyZWFtID0gb3B0cy5tYXBTdHJlYW0gfHwgZWNobwogIHZhciBzdGF0TmV4dCA9IHN0YXRBbGwoeGZzLCBvcHRzLmRlcmVmZXJlbmNlID8geGZzLnN0YXQgOiB4ZnMubHN0YXQsIGN3ZCwgaWdub3JlLCBvcHRzLmVudHJpZXMsIG9wdHMuc29ydCkKICB2YXIgc3RyaWN0ID0gb3B0cy5zdHJpY3QgIT09IGZhbHNlCiAgdmFyIHVtYXNrID0gdHlwZW9mIG9wdHMudW1hc2sgPT09ICdudW1iZXInID8gfm9wdHMudW1hc2sgOiB+cHJvY2Vzc1VtYXNrKCkKICB2YXIgZG1vZGUgPSB0eXBlb2Ygb3B0cy5kbW9kZSA9PT0gJ251bWJlcicgPyBvcHRzLmRtb2RlIDogMAogIHZhciBmbW9kZSA9IHR5cGVvZiBvcHRzLmZtb2RlID09PSAnbnVtYmVyJyA/IG9wdHMuZm1vZGUgOiAwCiAgdmFyIHBhY2sgPSBvcHRzLnBhY2sgfHwgdGFyLnBhY2soKQogIHZhciBmaW5pc2ggPSBvcHRzLmZpbmlzaCB8fCBub29wCgogIGlmIChvcHRzLnN0cmlwKSBtYXAgPSBzdHJpcChtYXAsIG9wdHMuc3RyaXApCgogIGlmIChvcHRzLnJlYWRhYmxlKSB7CiAgICBkbW9kZSB8PSBwYXJzZUludCg1NTUsIDgpCiAgICBmbW9kZSB8PSBwYXJzZUludCg0NDQsIDgpCiAgfQogIGlmIChvcHRzLndyaXRhYmxlKSB7CiAgICBkbW9kZSB8PSBwYXJzZUludCgzMzMsIDgpCiAgICBmbW9kZSB8PSBwYXJzZUludCgyMjIsIDgpCiAgfQoKICB2YXIgb25zeW1saW5rID0gZnVuY3Rpb24gKGZpbGVuYW1lLCBoZWFkZXIpIHsKICAgIHhmcy5yZWFkbGluayhwYXRoLmpvaW4oY3dkLCBmaWxlbmFtZSksIGZ1bmN0aW9uIChlcnIsIGxpbmtuYW1lKSB7CiAgICAgIGlmIChlcnIpIHJldHVybiBwYWNrLmRlc3Ryb3koZXJyKQogICAgICBoZWFkZXIubGlua25hbWUgPSBub3JtYWxpemUobGlua25hbWUpCiAgICAgIHBhY2suZW50cnkoaGVhZGVyLCBvbm5leHRlbnRyeSkKICAgIH0pCiAgfQoKICB2YXIgb25zdGF0ID0gZnVuY3Rpb24gKGVyciwgZmlsZW5hbWUsIHN0YXQpIHsKICAgIGlmIChlcnIpIHJldHVybiBwYWNrLmRlc3Ryb3koZXJyKQogICAgaWYgKCFmaWxlbmFtZSkgewogICAgICBpZiAob3B0cy5maW5hbGl6ZSAhPT0gZmFsc2UpIHBhY2suZmluYWxpemUoKQogICAgICByZXR1cm4gZmluaXNoKHBhY2spCiAgICB9CgogICAgaWYgKHN0YXQuaXNTb2NrZXQoKSkgcmV0dXJuIG9ubmV4dGVudHJ5KCkgLy8gdGFyIGRvZXMgbm90IHN1cHBvcnQgc29ja2V0cy4uLgoKICAgIHZhciBoZWFkZXIgPSB7CiAgICAgIG5hbWU6IG5vcm1hbGl6ZShmaWxlbmFtZSksCiAgICAgIG1vZGU6IChzdGF0Lm1vZGUgfCAoc3RhdC5pc0RpcmVjdG9yeSgpID8gZG1vZGUgOiBmbW9kZSkpICYgdW1hc2ssCiAgICAgIG10aW1lOiBzdGF0Lm10aW1lLAogICAgICBzaXplOiBzdGF0LnNpemUsCiAgICAgIHR5cGU6ICdmaWxlJywKICAgICAgdWlkOiBzdGF0LnVpZCwKICAgICAgZ2lkOiBzdGF0LmdpZAogICAgfQoKICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHsKICAgICAgaGVhZGVyLnNpemUgPSAwCiAgICAgIGhlYWRlci50eXBlID0gJ2RpcmVjdG9yeScKICAgICAgaGVhZGVyID0gbWFwKGhlYWRlcikgfHwgaGVhZGVyCiAgICAgIHJldHVybiBwYWNrLmVudHJ5KGhlYWRlciwgb25uZXh0ZW50cnkpCiAgICB9CgogICAgaWYgKHN0YXQuaXNTeW1ib2xpY0xpbmsoKSkgewogICAgICBoZWFkZXIuc2l6ZSA9IDAKICAgICAgaGVhZGVyLnR5cGUgPSAnc3ltbGluaycKICAgICAgaGVhZGVyID0gbWFwKGhlYWRlcikgfHwgaGVhZGVyCiAgICAgIHJldHVybiBvbnN5bWxpbmsoZmlsZW5hbWUsIGhlYWRlcikKICAgIH0KCiAgICAvLyBUT0RPOiBhZGQgZmlmbyBldGMuLi4KCiAgICBoZWFkZXIgPSBtYXAoaGVhZGVyKSB8fCBoZWFkZXIKCiAgICBpZiAoIXN0YXQuaXNGaWxlKCkpIHsKICAgICAgaWYgKHN0cmljdCkgcmV0dXJuIHBhY2suZGVzdHJveShuZXcgRXJyb3IoJ3Vuc3VwcG9ydGVkIHR5cGUgZm9yICcgKyBmaWxlbmFtZSkpCiAgICAgIHJldHVybiBvbm5leHRlbnRyeSgpCiAgICB9CgogICAgdmFyIGVudHJ5ID0gcGFjay5lbnRyeShoZWFkZXIsIG9ubmV4dGVudHJ5KQogICAgaWYgKCFlbnRyeSkgcmV0dXJuCgogICAgdmFyIHJzID0gbWFwU3RyZWFtKHhmcy5jcmVhdGVSZWFkU3RyZWFtKHBhdGguam9pbihjd2QsIGZpbGVuYW1lKSksIGhlYWRlcikKCiAgICBycy5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7IC8vIGFsd2F5cyBmb3J3YXJkIGVycm9ycyBvbiBkZXN0cm95CiAgICAgIGVudHJ5LmRlc3Ryb3koZXJyKQogICAgfSkKCiAgICBwdW1wKHJzLCBlbnRyeSkKICB9CgogIHZhciBvbm5leHRlbnRyeSA9IGZ1bmN0aW9uIChlcnIpIHsKICAgIGlmIChlcnIpIHJldHVybiBwYWNrLmRlc3Ryb3koZXJyKQogICAgc3RhdE5leHQob25zdGF0KQogIH0KCiAgb25uZXh0ZW50cnkoKQoKICByZXR1cm4gcGFjawp9Cgp2YXIgaGVhZCA9IGZ1bmN0aW9uIChsaXN0KSB7CiAgcmV0dXJuIGxpc3QubGVuZ3RoID8gbGlzdFtsaXN0Lmxlbmd0aCAtIDFdIDogbnVsbAp9Cgp2YXIgcHJvY2Vzc0dldHVpZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gcHJvY2Vzcy5nZXR1aWQgPyBwcm9jZXNzLmdldHVpZCgpIDogLTEKfQoKdmFyIHByb2Nlc3NVbWFzayA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gcHJvY2Vzcy51bWFzayA/IHByb2Nlc3MudW1hc2soKSA6IDAKfQoKZXhwb3J0cy5leHRyYWN0ID0gZnVuY3Rpb24gKGN3ZCwgb3B0cykgewogIGlmICghY3dkKSBjd2QgPSAnLicKICBpZiAoIW9wdHMpIG9wdHMgPSB7fQoKICB2YXIgeGZzID0gb3B0cy5mcyB8fCBmcwogIHZhciBpZ25vcmUgPSBvcHRzLmlnbm9yZSB8fCBvcHRzLmZpbHRlciB8fCBub29wCiAgdmFyIG1hcCA9IG9wdHMubWFwIHx8IG5vb3AKICB2YXIgbWFwU3RyZWFtID0gb3B0cy5tYXBTdHJlYW0gfHwgZWNobwogIHZhciBvd24gPSBvcHRzLmNob3duICE9PSBmYWxzZSAmJiAhd2luMzIgJiYgcHJvY2Vzc0dldHVpZCgpID09PSAwCiAgdmFyIGV4dHJhY3QgPSBvcHRzLmV4dHJhY3QgfHwgdGFyLmV4dHJhY3QoKQogIHZhciBzdGFjayA9IFtdCiAgdmFyIG5vdyA9IG5ldyBEYXRlKCkKICB2YXIgdW1hc2sgPSB0eXBlb2Ygb3B0cy51bWFzayA9PT0gJ251bWJlcicgPyB+b3B0cy51bWFzayA6IH5wcm9jZXNzVW1hc2soKQogIHZhciBkbW9kZSA9IHR5cGVvZiBvcHRzLmRtb2RlID09PSAnbnVtYmVyJyA/IG9wdHMuZG1vZGUgOiAwCiAgdmFyIGZtb2RlID0gdHlwZW9mIG9wdHMuZm1vZGUgPT09ICdudW1iZXInID8gb3B0cy5mbW9kZSA6IDAKICB2YXIgc3RyaWN0ID0gb3B0cy5zdHJpY3QgIT09IGZhbHNlCgogIGlmIChvcHRzLnN0cmlwKSBtYXAgPSBzdHJpcChtYXAsIG9wdHMuc3RyaXApCgogIGlmIChvcHRzLnJlYWRhYmxlKSB7CiAgICBkbW9kZSB8PSBwYXJzZUludCg1NTUsIDgpCiAgICBmbW9kZSB8PSBwYXJzZUludCg0NDQsIDgpCiAgfQogIGlmIChvcHRzLndyaXRhYmxlKSB7CiAgICBkbW9kZSB8PSBwYXJzZUludCgzMzMsIDgpCiAgICBmbW9kZSB8PSBwYXJzZUludCgyMjIsIDgpCiAgfQoKICB2YXIgdXRpbWVzUGFyZW50ID0gZnVuY3Rpb24gKG5hbWUsIGNiKSB7IC8vIHdlIGp1c3Qgc2V0IHRoZSBtdGltZSBvbiB0aGUgcGFyZW50IGRpciBhZ2FpbiBldmVyeXRpbWUgd2Ugd3JpdGUgYW4gZW50cnkKICAgIHZhciB0b3AKICAgIHdoaWxlICgodG9wID0gaGVhZChzdGFjaykpICYmIG5hbWUuc2xpY2UoMCwgdG9wWzBdLmxlbmd0aCkgIT09IHRvcFswXSkgc3RhY2sucG9wKCkKICAgIGlmICghdG9wKSByZXR1cm4gY2IoKQogICAgeGZzLnV0aW1lcyh0b3BbMF0sIG5vdywgdG9wWzFdLCBjYikKICB9CgogIHZhciB1dGltZXMgPSBmdW5jdGlvbiAobmFtZSwgaGVhZGVyLCBjYikgewogICAgaWYgKG9wdHMudXRpbWVzID09PSBmYWxzZSkgcmV0dXJuIGNiKCkKCiAgICBpZiAoaGVhZGVyLnR5cGUgPT09ICdkaXJlY3RvcnknKSByZXR1cm4geGZzLnV0aW1lcyhuYW1lLCBub3csIGhlYWRlci5tdGltZSwgY2IpCiAgICBpZiAoaGVhZGVyLnR5cGUgPT09ICdzeW1saW5rJykgcmV0dXJuIHV0aW1lc1BhcmVudChuYW1lLCBjYikgLy8gVE9ETzogaG93IHRvIHNldCBtdGltZSBvbiBsaW5rPwoKICAgIHhmcy51dGltZXMobmFtZSwgbm93LCBoZWFkZXIubXRpbWUsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgaWYgKGVycikgcmV0dXJuIGNiKGVycikKICAgICAgdXRpbWVzUGFyZW50KG5hbWUsIGNiKQogICAgfSkKICB9CgogIHZhciBjaHBlcm0gPSBmdW5jdGlvbiAobmFtZSwgaGVhZGVyLCBjYikgewogICAgdmFyIGxpbmsgPSBoZWFkZXIudHlwZSA9PT0gJ3N5bWxpbmsnCiAgICB2YXIgY2htb2QgPSBsaW5rID8geGZzLmxjaG1vZCA6IHhmcy5jaG1vZAogICAgdmFyIGNob3duID0gbGluayA/IHhmcy5sY2hvd24gOiB4ZnMuY2hvd24KCiAgICBpZiAoIWNobW9kKSByZXR1cm4gY2IoKQoKICAgIHZhciBtb2RlID0gKGhlYWRlci5tb2RlIHwgKGhlYWRlci50eXBlID09PSAnZGlyZWN0b3J5JyA/IGRtb2RlIDogZm1vZGUpKSAmIHVtYXNrCiAgICBjaG1vZChuYW1lLCBtb2RlLCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgIGlmIChlcnIpIHJldHVybiBjYihlcnIpCiAgICAgIGlmICghb3duKSByZXR1cm4gY2IoKQogICAgICBpZiAoIWNob3duKSByZXR1cm4gY2IoKQogICAgICBjaG93bihuYW1lLCBoZWFkZXIudWlkLCBoZWFkZXIuZ2lkLCBjYikKICAgIH0pCiAgfQoKICBleHRyYWN0Lm9uKCdlbnRyeScsIGZ1bmN0aW9uIChoZWFkZXIsIHN0cmVhbSwgbmV4dCkgewogICAgaGVhZGVyID0gbWFwKGhlYWRlcikgfHwgaGVhZGVyCiAgICBoZWFkZXIubmFtZSA9IG5vcm1hbGl6ZShoZWFkZXIubmFtZSkKICAgIHZhciBuYW1lID0gcGF0aC5qb2luKGN3ZCwgcGF0aC5qb2luKCcvJywgaGVhZGVyLm5hbWUpKQoKICAgIGlmIChpZ25vcmUobmFtZSwgaGVhZGVyKSkgewogICAgICBzdHJlYW0ucmVzdW1lKCkKICAgICAgcmV0dXJuIG5leHQoKQogICAgfQoKICAgIHZhciBzdGF0ID0gZnVuY3Rpb24gKGVycikgewogICAgICBpZiAoZXJyKSByZXR1cm4gbmV4dChlcnIpCiAgICAgIHV0aW1lcyhuYW1lLCBoZWFkZXIsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBpZiAoZXJyKSByZXR1cm4gbmV4dChlcnIpCiAgICAgICAgaWYgKHdpbjMyKSByZXR1cm4gbmV4dCgpCiAgICAgICAgY2hwZXJtKG5hbWUsIGhlYWRlciwgbmV4dCkKICAgICAgfSkKICAgIH0KCiAgICB2YXIgb25zeW1saW5rID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAod2luMzIpIHJldHVybiBuZXh0KCkgLy8gc2tpcCBzeW1saW5rcyBvbiB3aW4gZm9yIG5vdyBiZWZvcmUgaXQgY2FuIGJlIHRlc3RlZAogICAgICB4ZnMudW5saW5rKG5hbWUsIGZ1bmN0aW9uICgpIHsKICAgICAgICB4ZnMuc3ltbGluayhoZWFkZXIubGlua25hbWUsIG5hbWUsIHN0YXQpCiAgICAgIH0pCiAgICB9CgogICAgdmFyIG9ubGluayA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHdpbjMyKSByZXR1cm4gbmV4dCgpIC8vIHNraXAgbGlua3Mgb24gd2luIGZvciBub3cgYmVmb3JlIGl0IGNhbiBiZSB0ZXN0ZWQKICAgICAgeGZzLnVubGluayhuYW1lLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNyY3BhdGggPSBwYXRoLnJlc29sdmUoY3dkLCBoZWFkZXIubGlua25hbWUpCgogICAgICAgIHhmcy5saW5rKHNyY3BhdGgsIG5hbWUsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIGlmIChlcnIgJiYgZXJyLmNvZGUgPT09ICdFUEVSTScgJiYgb3B0cy5oYXJkbGlua0FzRmlsZXNGYWxsYmFjaykgewogICAgICAgICAgICBzdHJlYW0gPSB4ZnMuY3JlYXRlUmVhZFN0cmVhbShzcmNwYXRoKQogICAgICAgICAgICByZXR1cm4gb25maWxlKCkKICAgICAgICAgIH0KCiAgICAgICAgICBzdGF0KGVycikKICAgICAgICB9KQogICAgICB9KQogICAgfQoKICAgIHZhciBvbmZpbGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB3cyA9IHhmcy5jcmVhdGVXcml0ZVN0cmVhbShuYW1lKQogICAgICB2YXIgcnMgPSBtYXBTdHJlYW0oc3RyZWFtLCBoZWFkZXIpCgogICAgICB3cy5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7IC8vIGFsd2F5cyBmb3J3YXJkIGVycm9ycyBvbiBkZXN0cm95CiAgICAgICAgcnMuZGVzdHJveShlcnIpCiAgICAgIH0pCgogICAgICBwdW1wKHJzLCB3cywgZnVuY3Rpb24gKGVycikgewogICAgICAgIGlmIChlcnIpIHJldHVybiBuZXh0KGVycikKICAgICAgICB3cy5vbignY2xvc2UnLCBzdGF0KQogICAgICB9KQogICAgfQoKICAgIGlmIChoZWFkZXIudHlwZSA9PT0gJ2RpcmVjdG9yeScpIHsKICAgICAgc3RhY2sucHVzaChbbmFtZSwgaGVhZGVyLm10aW1lXSkKICAgICAgcmV0dXJuIG1rZGlyZml4KG5hbWUsIHsKICAgICAgICBmczogeGZzLCBvd246IG93biwgdWlkOiBoZWFkZXIudWlkLCBnaWQ6IGhlYWRlci5naWQKICAgICAgfSwgc3RhdCkKICAgIH0KCiAgICB2YXIgZGlyID0gcGF0aC5kaXJuYW1lKG5hbWUpCgogICAgdmFsaWRhdGUoeGZzLCBkaXIsIHBhdGguam9pbihjd2QsICcuJyksIGZ1bmN0aW9uIChlcnIsIHZhbGlkKSB7CiAgICAgIGlmIChlcnIpIHJldHVybiBuZXh0KGVycikKICAgICAgaWYgKCF2YWxpZCkgcmV0dXJuIG5leHQobmV3IEVycm9yKGRpciArICcgaXMgbm90IGEgdmFsaWQgcGF0aCcpKQoKICAgICAgbWtkaXJmaXgoZGlyLCB7CiAgICAgICAgZnM6IHhmcywgb3duOiBvd24sIHVpZDogaGVhZGVyLnVpZCwgZ2lkOiBoZWFkZXIuZ2lkCiAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBpZiAoZXJyKSByZXR1cm4gbmV4dChlcnIpCgogICAgICAgIHN3aXRjaCAoaGVhZGVyLnR5cGUpIHsKICAgICAgICAgIGNhc2UgJ2ZpbGUnOiByZXR1cm4gb25maWxlKCkKICAgICAgICAgIGNhc2UgJ2xpbmsnOiByZXR1cm4gb25saW5rKCkKICAgICAgICAgIGNhc2UgJ3N5bWxpbmsnOiByZXR1cm4gb25zeW1saW5rKCkKICAgICAgICB9CgogICAgICAgIGlmIChzdHJpY3QpIHJldHVybiBuZXh0KG5ldyBFcnJvcigndW5zdXBwb3J0ZWQgdHlwZSBmb3IgJyArIG5hbWUgKyAnICgnICsgaGVhZGVyLnR5cGUgKyAnKScpKQoKICAgICAgICBzdHJlYW0ucmVzdW1lKCkKICAgICAgICBuZXh0KCkKICAgICAgfSkKICAgIH0pCiAgfSkKCiAgaWYgKG9wdHMuZmluaXNoKSBleHRyYWN0Lm9uKCdmaW5pc2gnLCBvcHRzLmZpbmlzaCkKCiAgcmV0dXJuIGV4dHJhY3QKfQoKZnVuY3Rpb24gdmFsaWRhdGUgKGZzLCBuYW1lLCByb290LCBjYikgewogIGlmIChuYW1lID09PSByb290KSByZXR1cm4gY2IobnVsbCwgdHJ1ZSkKICBmcy5sc3RhdChuYW1lLCBmdW5jdGlvbiAoZXJyLCBzdCkgewogICAgaWYgKGVyciAmJiBlcnIuY29kZSAhPT0gJ0VOT0VOVCcpIHJldHVybiBjYihlcnIpCiAgICBpZiAoZXJyIHx8IHN0LmlzRGlyZWN0b3J5KCkpIHJldHVybiB2YWxpZGF0ZShmcywgcGF0aC5qb2luKG5hbWUsICcuLicpLCByb290LCBjYikKICAgIGNiKG51bGwsIGZhbHNlKQogIH0pCn0KCmZ1bmN0aW9uIG1rZGlyZml4IChuYW1lLCBvcHRzLCBjYikgewogIG1rZGlycChuYW1lLCB7ZnM6IG9wdHMueGZzfSwgZnVuY3Rpb24gKGVyciwgbWFkZSkgewogICAgaWYgKCFlcnIgJiYgbWFkZSAmJiBvcHRzLm93bikgewogICAgICBjaG93bnIobWFkZSwgb3B0cy51aWQsIG9wdHMuZ2lkLCBjYikKICAgIH0gZWxzZSB7CiAgICAgIGNiKGVycikKICAgIH0KICB9KQp9Cg==" }

